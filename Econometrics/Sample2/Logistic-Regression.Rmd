---
title: "Logistic Regression"
author: "Matthew Seguin"
geometry: margin=1.5cm
output:
  pdf_document: default
  html_document: default
---

# 3.
```{r}
library(rio)
cps_98 <- import("cps98_short.xls")
```
## a.
```{r}
reg1 <- lm(ahe ~ age + female + bachelor, data = cps_98)
summary(reg1)
```
\begin{center}
We just ran the regression $ahe =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor + U$.
\\Under this model if all other variables are held constant and $age$ increases by 1
\\(i.e. $age_1 = age_0 + 1$) we will get the following:
$$\Delta ahe = ahe_1 - ahe_0 = (\beta _0 +\beta _1 age_1 +\beta _2 female +\beta _3 bachelor) - (\beta _0 +\beta _1 age_0 +\beta _2 female +\beta _3 bachelor) =\beta _1 (age_1 - age_0) =\beta _1$$
Therefore the expected change in $ahe$ for $age$ going from 25 to 26 is the same as that of $age$ going from 33 to 34 since both are just increases by 1.
\\As per above we have that in both cases $\Delta ahe =\beta _1\approx\hat{\beta}_1$.
\\This was estimated via the results of our regression using OLS, the result ($\hat{\beta}_1$) is shown below.
\end{center}
```{r}
as.numeric(reg1$coefficients[2])
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 25 to 26 or age going from 33 to 34, holding all other variables constant, is an increase of 0.2911944 which is \$0.2911944 in the real world.
\end{center}

## b.
```{r}
reg2 <- lm(log(ahe) ~ age + female + bachelor, data = cps_98)
summary(reg2)
```
\begin{center}
We just ran the regression $log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor + U$.
\\Under this model if all other variables are held constant and $age$ increases by 1 (i.e. $\Delta age = 1$) we will get the following:
$$log(ahe +\Delta ahe) - log(ahe) = (\beta _0 +\beta _1 (age +\Delta age) +\beta _2 female +\beta _3 bachelor) - (\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor) =\beta _1 (\Delta age) =\beta _1$$
Now recall that $log(x +\Delta x) - log(x)\approx\frac{\Delta x}{x}$.
\\So in our case we have that:
$$\frac{\Delta ahe}{ahe}\approx log(ahe +\Delta ahe) - log(ahe) =\beta _1$$
Therefore an increase in $age$ by 1 causes an expected increase in $ahe$ by about $100\beta _1\%\approx 100\hat{\beta}_1\%$.
\\This can be estimated via the results of our regression using OLS, the results are shown below.
\end{center}
```{r}
as.numeric(reg2$coefficients[2])
100*as.numeric(reg2$coefficients[2])
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 25 to 26 or age going from 33 to 34, holding all other variables constant, is an increase in average hourly earnings by about $1.890923\%$.
\vspace{1in}
\\If we want to find the estimated total change in $ahe$ we may use the following process which I have on the next page.
\newpage
When age increases by 1 (i.e. $\Delta age = 1$) the expected change in $ahe$ is given by:
$$\Delta ahe\approx\beta _1 ahe\approx\hat{\beta}_1\hat{ahe}$$
This can be estimated via the results of our regression using OLS. If we use the desired value for $age$ and mean of the other regressors then we can approximate $\hat{ahe}$ for a given age:
$$log(\hat{ahe})\approx\hat{log(ahe)} =\hat{\beta}_0 +\hat{\beta}_1 age +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)$$
From which it follows:
$$\hat{ahe} = e^{log(\hat{ahe})}\approx e^{\hat{log(ahe)}} = e^{\hat{\beta}_0 +\hat{\beta}_1 age +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)}$$
The means of the regressors from our data are shown below.
\end{center}
```{r}
b_0_hat <- as.numeric(reg2$coefficients[1])
b_1_hat <- as.numeric(reg2$coefficients[2])
b_2_hat <- as.numeric(reg2$coefficients[3])
b_3_hat <- as.numeric(reg2$coefficients[4])
E_bachelor <- mean(cps_98$bachelor)
E_bachelor
E_female <- mean(cps_98$female)
E_female
```
\begin{itemize}
\item For $age$ going from 25 to 26:
\end{itemize}
\begin{center}
Under our model:
$$log(\hat{ahe})\approx\hat{\beta}_0 + 25\hat{\beta}_1 +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)$$
The result of which is shown below.
\end{center}
```{r}
log_ahe_hat_25 <- b_0_hat + 25*b_1_hat + b_2_hat*E_female + b_3_hat*E_bachelor
ahe_hat_25 <- exp(log_ahe_hat_25)
delta_ahe_hat_25 <- b_1_hat*ahe_hat_25
delta_ahe_hat_25
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 25 to 26, holding all other variables constant, is an increase of 0.2254735 which is \$0.2254735 in the real world.
\end{center}
\begin{itemize}
\item For $age$ going from 33 to 34:
\end{itemize}
\begin{center}
Under our model:
$$log(\hat{ahe})\approx\hat{\beta}_0 + 33\hat{\beta}_1 +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)$$
The result of which is shown below.
\end{center}
```{r}
log_ahe_hat_33 <- b_0_hat + 33*b_1_hat + b_2_hat*E_female + b_3_hat*E_bachelor
ahe_hat_33 <- exp(log_ahe_hat_33)
delta_ahe_hat_33 <- b_1_hat*ahe_hat_33
delta_ahe_hat_33
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 33 to 34, holding all other variables constant, is an increase of 0.2622967 which is \$0.2622967 in the real world.
\end{center}

\newpage
## c.
```{r}
reg3 <- lm(log(ahe) ~ log(age) + female + bachelor, data = cps_98)
summary(reg3)
```
\begin{center}
We just ran the regression $log(ahe) =\beta _0 +\beta _1 log(age) +\beta _2 female +\beta _3 bachelor + U$.
\\Under this model if all other variables are held constant and $age$ increases by 1 (i.e. $\Delta age = 1$) we will get the following:
$$log(ahe +\Delta ahe) - log(ahe) = (\beta _0 +\beta _1 log(age +\Delta age) +\beta _2 female +\beta _3 bachelor) - (\beta _0 +\beta _1 log(age) +\beta _2 female +\beta _3 bachelor)$$
$$=\beta _1\big{(}log(age +\Delta age) - log(age)\big{)}$$
Now recall that $log(x +\Delta x) - log(x)\approx\frac{\Delta x}{x}$.
\\So in our case we have that:
$$\frac{\Delta ahe}{ahe}\approx log(ahe +\Delta ahe) - log(ahe) =\beta _1\big{(}log(age +\Delta age) - log(age)\big{)}\approx\beta _1\frac{\Delta age}{age} =\beta _1\frac{1}{age}$$
Therefore an increase in $age$ by 1 causes an expected increase in $ahe$ by about $100\frac{\beta _1}{age}\%\approx 100\frac{\hat{\beta}_1}{age}\%$.
\\This can be estimated via the results of our regression using OLS, the results are shown below.
\end{center}
\begin{itemize}
\item For $age$ going from 25 to 26:
\end{itemize}
```{r}
100*as.numeric(reg3$coefficients[2])/25
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 25 to 26, holding all other variables constant, is an increase in average hourly earnings by about $2.207615\%$.
\end{center}
\begin{itemize}
\item For $age$ going from 33 to 34:
\end{itemize}
```{r}
100*as.numeric(reg3$coefficients[2])/33
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 33 to 34, holding all other variables constant, is an increase in average hourly earnings by about $1.672436\%$.
\vspace{1in}
\\If we want to find the estimated total change in $ahe$ we may use the following process which I have on the next page.
\newpage
When age increases by 1 (i.e. $\Delta age = 1$) the expected change in $ahe$ is given by:
$$\Delta ahe\approx\beta _1\frac{ahe}{age}\approx\hat{\beta}_1\frac{\hat{ahe}}{age}$$
This can be estimated via the results of our regression using OLS. If we use the desired value for $age$ and mean of the other regressors then we can approximate $\hat{ahe}$ for a given age:
$$log(\hat{ahe})\approx\hat{log(ahe)} =\hat{\beta}_0 +\hat{\beta}_1 log(age) +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)$$
From which it follows:
$$\hat{ahe} = e^{log(\hat{ahe})}\approx e^{\hat{log(ahe)}} = e^{\hat{\beta}_0 +\hat{\beta}_1 log(age) +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)}$$
The means of the other regressors were found before here they are displayed again.
\end{center}
```{r}
b_0_hat <- as.numeric(reg3$coefficients[1])
b_1_hat <- as.numeric(reg3$coefficients[2])
b_2_hat <- as.numeric(reg3$coefficients[3])
b_3_hat <- as.numeric(reg3$coefficients[4])
E_bachelor
E_female
```
\begin{itemize}
\item For $age$ going from 25 to 26:
\end{itemize}
\begin{center}
Under our model:
$$log(\hat{ahe})\approx\hat{\beta}_0 +\hat{\beta}_1 log(25) +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)$$
The result of which is shown below.
\end{center}
```{r}
log_ahe_hat_25 <- b_0_hat + log(25)*b_1_hat + b_2_hat*E_female + b_3_hat*E_bachelor
ahe_hat_25 <- exp(log_ahe_hat_25)
delta_ahe_hat_25 <- b_1_hat*ahe_hat_25/25
delta_ahe_hat_25
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 25 to 26, holding all other variables constant, is an increase of 0.2622447 which is \$0.2622447 in the real world.
\end{center}
\begin{itemize}
\item For $age$ going from 33 to 34:
\end{itemize}
\begin{center}
Under our model:
$$log(\hat{ahe})\approx\hat{\beta}_0 +\hat{\beta}_1 log(33) +\hat{\beta}_2\mathbb{E}(female) +\hat{\beta}_3\mathbb{E}(bachelor)$$
The result of which is shown below.
\end{center}
```{r}
log_ahe_hat_33 <- b_0_hat + log(33)*b_1_hat + b_2_hat*E_female + b_3_hat*E_bachelor
ahe_hat_33 <- exp(log_ahe_hat_33)
delta_ahe_hat_33 <- b_1_hat*ahe_hat_33/33
delta_ahe_hat_33
```
\begin{center}
So the estimated change in average hourly earnings as a result of age going from 33 to 34, holding all other variables constant, is an increase of 0.2315677 which is \$0.2315677 in the real world.
\end{center}

\newpage
## d.
\begin{center}
To answer the question of whether the effect of age on average hourly earnings is different for men and women we need to add another variable to our regression that includes information about both simultaneously. It is fairly intuitive to make the variable $agegen = (age)(female)$, the product of the variables age and female, then run a previous regression adding the new variable. I will run the regression of $log(ahe)$ using $age$, $female$, $bachelor$, and $agegen$ as regressors, I don't want to use $log(age)$ because I want to see the effect of just age in comparison to gender.
\end{center}
```{r}
agegen <- cps_98$age*cps_98$female
cps_98$agegen <- agegen
reg4 <- lm(log(ahe) ~ age + female + bachelor + agegen, data = cps_98)
summary(reg4)
```
\begin{center}
We just ran the regression $log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor +\beta_4 age\times female + U$.
\\Under this model if a person is female ($female = 1$) then we get:
$$log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor +\beta_4 age\times female =\beta _0 +\beta _1 age +\beta _2 +\beta _3 bachelor +\beta_4 age$$
$$= (\beta _0 +\beta _2) + (\beta _1 +\beta _4) age +\beta _3 bachelor$$
So the effect on $log(ahe)$ as a result of $age$ is given by $\beta _1 +\beta _4$ when a person is female (i.e. $female = 1$).
\\Under this model if a person is female ($female = 0$) then we get:
$$log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor +\beta_4 age\times female =\beta _0 +\beta _1 age +\beta _3 bachelor$$
So the effect on $log(ahe)$ as a result of $age$ is given by $\beta _1$ when a person is male (i.e. $female = 0$).
\break
\\Therefore if we want to test if the effect of age on average hourly earnings is different for men and women we can test the simple hypothesis $H_0:\beta _4 = 0$.
\vspace{1in}
\\I will perform this test on the next page.
\newpage
We know the OLS estimate from our regression and we know the coefficient is approximately normal so we can find the p-value with the t-statistic.
$$t_{H_0} =\frac{\hat{\beta}_4 - 0}{SE(\hat{\beta}_4)} =\frac{\hat{\beta}_4 - 0}{SE(\hat{\beta}_4)}\sim N(0, 1)$$
We can compute this manually or just get the result from our regression, I will show both below.
\end{center}
```{r}
reg4_data <- summary(reg4)
b_4_hat <- reg4_data$coefficients[5, "Estimate"]
b_4_hat
se_b_4_hat <- reg4_data$coefficients[5, "Std. Error"]
se_b_4_hat
t_calc <- b_4_hat / se_b_4_hat
t_calc
t_from_reg <- reg4_data$coefficients[5, "t value"]
t_from_reg
```
\begin{center}
As you can see both t statistics are the same, the calculated one and the one just extracted from the regression. I will now calculate the p-value and give a conclusion. We can compute the p-value directly or just extract it from the regression, again I will show both below.
\end{center}
```{r}
p_calc <- 2*pnorm(-abs(t_calc))
p_calc
p_from_reg <- reg4_data$coefficients[5, "Pr(>|t|)"]
p_from_reg
```
\begin{center}
As you can see these are both very close, the reason they are not exactly the same is because I used a normal approximation while R used the exact p-value from the t distribution.
\break
\\In either case we see the p-value $>\alpha = 0.05$ so we do not reject $H_0:\beta _4 = 0$.
\\That is we can say that the effect of age on average hourly earnings is NOT different for men and women.
\end{center}

\newpage
## e.
\begin{center}
Similar to the previous part, to answer the question of whether the effect of age on average hourly earnings is different for high school graduates and college graduates we need to add another variable to our regression that includes information about both simultaneously. It is fairly intuitive to make the variable $agecol = (age)(bachelor)$, the product of the variables age and bachelor, then run a previous regression adding the new variable. I will run the regression of $log(ahe)$ using $age$, $female$, $bachelor$, and $agecol$ as regressors, I don't want to use $log(age)$ because I want to see the effect of just age in comparison to education.
\end{center}
```{r}
agecol <- cps_98$age*cps_98$bachelor
cps_98$agecol <- agecol
reg5 <- lm(log(ahe) ~ age + female + bachelor + agecol, data = cps_98)
summary(reg5)
```
\begin{center}
We just ran the regression $log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor +\beta_4 age\times bachelor + U$.
\\Under this model if a person is a college graduate ($bachelor = 1$) then we get:
$$log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor +\beta_4 age\times bachelor =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 +\beta_4 age$$
$$= (\beta _0 +\beta _3) + (\beta _1 +\beta _4) age +\beta _2 bachelor$$
So the effect on $log(ahe)$ as a result of $age$ is given by $\beta _1 +\beta _4$ when a person is a college graduate (i.e. $bachelor = 1$).
\\Under this model if a person is only a high school graduate ($bachelor = 0$) then we get:
$$log(ahe) =\beta _0 +\beta _1 age +\beta _2 female +\beta _3 bachelor +\beta_4 age\times bachelor =\beta _0 +\beta _1 age +\beta _2 female$$
So the effect on $log(ahe)$ as a result of $age$ is given by $\beta _1$ when a person is only a high school graduate (i.e. $bachelor = 0$).
\break
\\Therefore if we want to test if the effect of age on average hourly earnings is different for high school graduates and
\\college graduates we can test the simple hypothesis $H_0:\beta _4 = 0$.
\vspace{1in}
\\I will perform this test on the next page (it is a similar process to the previous part).
\newpage
We know the OLS estimate from our regression and we know the coefficient is approximately normal so we can find the p-value with the t-statistic.
$$t_{H_0} =\frac{\hat{\beta}_4 - 0}{SE(\hat{\beta}_4)} =\frac{\hat{\beta}_4 - 0}{SE(\hat{\beta}_4)}\sim N(0, 1)$$
We can compute this manually or just get the result from our regression, I will show both below.
\end{center}
```{r}
reg5_data <- summary(reg5)
b_4_hat <- reg5_data$coefficients[5, "Estimate"]
b_4_hat
se_b_4_hat <- reg5_data$coefficients[5, "Std. Error"]
se_b_4_hat
t_calc <- b_4_hat / se_b_4_hat
t_calc
t_from_reg <- reg5_data$coefficients[5, "t value"]
t_from_reg
```
\begin{center}
As you can see both t statistics are the same, the calculated one and the one just extracted from the regression. I will now calculate the p-value and give a conclusion. We can compute the p-value directly or just extract it from the regression, again I will show both below.
\end{center}
```{r}
p_calc <- 2*pnorm(-abs(t_calc))
p_calc
p_from_reg <- reg5_data$coefficients[5, "Pr(>|t|)"]
p_from_reg
```
\begin{center}
As you can see these are both very close, the reason they are not exactly the same is because I used a normal approximation while R used the exact p-value from the t distribution.
\break
\\In either case we see the p-value $>\alpha = 0.05$ so we do not reject $H_0:\beta _4 = 0$.
\\That is we can say that the effect of age on average hourly earnings is NOT different for high school graduates and college graduates.
\end{center}